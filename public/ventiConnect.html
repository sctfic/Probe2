<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Venti'Connect - Compact</title>
    <style>
        body { font-family: system-ui, -apple-system, sans-serif; margin: 0; padding: 10px; background: #eee; height: 100vh; box-sizing: border-box; display: flex; flex-direction: column; gap: 10px; }
        
        /* Layout Grid */
        .main-layout { display: grid; grid-template-columns: 320px 1fr; gap: 10px; flex: 1; min-height: 0; }
        .panel { background: #fff; border: 1px solid #ccc; padding: 10px; border-radius: 4px; overflow-y: auto; }
        
        /* Elements compacts */
        h3 { margin: 0 0 8px 0; font-size: 14px; border-bottom: 2px solid #ddd; padding-bottom: 4px; text-transform: uppercase; color: #555; }
        .row { display: flex; gap: 5px; margin-bottom: 5px; align-items: center; }
        label { font-size: 12px; font-weight: bold; width: 100px; display: block; }
        input, select { font-size: 12px; padding: 3px; flex: 1; border: 1px solid #aaa; border-radius: 3px; }
        
        /* Boutons */
        button { font-size: 11px; padding: 4px 8px; cursor: pointer; border: 1px solid #999; border-radius: 3px; background: #e0e0e0; flex: 1; font-weight: 600; }
        button:hover { background: #d0d0d0; }
        .btn-red { background: #ffcccc; border-color: #ff9999; color: #900; }
        .btn-green { background: #ccffcc; border-color: #99ff99; color: #060; }
        .btn-blue { background: #cceeff; border-color: #99ccff; color: #004488; }
        .btn-sub { background: #2c3e50; color: white; border: none; padding: 6px; }

        /* Output Zone */
        #outputPanel { display: flex; flex-direction: column; background: #222; color: #0f0; border: none; }
        #statusLine { font-size: 12px; color: #aaa; padding-bottom: 5px; border-bottom: 1px solid #444; margin-bottom: 5px; }
        pre { margin: 0; font-family: 'Consolas', monospace; font-size: 11px; white-space: pre-wrap; overflow-y: auto; flex: 1; }

        /* Sections */
        .section-group { background: #f9f9f9; padding: 5px; border: 1px solid #eee; margin-bottom: 8px; }
        .section-title { font-size: 10px; color: #888; margin-bottom: 4px; display: block; text-transform: uppercase; }
    </style>
</head>
<body>

    <div style="display: flex; gap: 10px; align-items: center; background: #fff; padding: 5px 10px; border-radius: 4px; border: 1px solid #ccc;">
        <strong style="font-size: 14px;">Venti'Connect</strong>
        <input type="text" id="hostInput" value="venticonnect.lan" style="max-width: 150px;">
        <button onclick="ping()" style="flex: none; width: auto;">PING</button>
    </div>

    <div class="main-layout">
        <div class="panel">
            <h3>Contrôles</h3>
            
            <div class="section-group">
                <span class="section-title">État Système</span>
                <div class="row">
                    <button class="btn-red" onclick="GET('/off')">STOP</button>
                    <button class="btn-red" onclick="GET('/restart')">RESTART</button>
                </div>
                <div class="row">
                    <button class="btn-green" onclick="GET('/auto')">AUTO (Hiver)</button>
                    <button class="btn-green" onclick="GET('/ete')">ÉTÉ</button>
                </div>
            </div>

            <div class="section-group">
                <span class="section-title">Vitesse Manuelle</span>
                <div class="row">
                    <button onclick="GET('/Silence')">Silence</button>
                    <button onclick="GET('/Normal')">Moyen</button>
                    <button onclick="GET('/Boost')">Boost</button>
                </div>
            </div>

            <div class="section-group">
                <span class="section-title">Lecture Données</span>
                <div class="row"><button class="btn-blue" onclick="GET('/RecupInfo')">RecupInfo (Live)</button></div>
                <div class="row">
                    <button onclick="GET('/JsonConf.json')">Conf</button>
                    <button onclick="GET('/Chart1.json')">Chart J</button>
                    <button onclick="GET('/Chart7.json')">Chart J-7</button>
                </div>
                <div class="row">
                    <button onclick="GET('/LogFile1.json')">Log J</button>
                    <button onclick="GET('/LogFile3.json')">Log J-2</button>
                </div>
            </div>

            <h3>Configuration (POST)</h3>
            <form id="f" onsubmit="POST(event)">
                <div class="row"><label>Consigne °C</label><input type="number" id="c_deg" value="20" min="15" max="30"></div>
                <div class="row"><label>Consigne Elec</label><input type="number" id="c_elec" value="19" min="1" max="25"></div>
                <div class="row"><label>Gain</label>
                    <select id="n_gain"><option>2</option><option selected>3</option><option>4</option><option>5</option></select>
                </div>
                <div class="row"><label>Gaine</label>
                    <select id="c_gaine"><option value="0">0</option><option value="10m">10m</option><option value="20m">20m</option><option value="30m">30m</option></select>
                </div>
                <div class="row"><label>Force</label>
                    <select id="c_force"><option value="0">Auto (0)</option><option value="1">1</option><option value="2">2</option><option value="3">3</option></select>
                </div>
                <div class="row"><label>IP PC</label><input type="text" id="ip_pc" placeholder="x.x.x.x"></div>
                <button type="submit" class="btn-sub">ENVOYER (/Consigne)</button>
            </form>
        </div>

        <div class="panel" id="outputPanel">
            <div id="statusLine">Prêt.</div>
            <pre id="out">...</pre>
        </div>
    </div>

    <script>
        const $ = id => document.getElementById(id);
        const url = () => {
            let h = $('hostInput').value.trim();
            return (h.startsWith('http') ? h : 'http://' + h).replace(/\/$/, '');
        };
        const log = (d, err=false) => {
            $('out').innerText = (typeof d==='object') ? JSON.stringify(d, null, 2) : d;
            $('out').style.color = err ? '#ff5555' : '#0f0';
        };
        const status = (m, u) => $('statusLine').innerText = `[${m}] ${u}`;

        async function req(m, path, body=null) {
            const u = url() + path;
            status(m, u);
            log("...");
            try {
                const opts = { method: m };
                if(body) {
                    opts.headers = {'Content-Type': 'application/json'};
                    opts.body = JSON.stringify(body);
                }
                const r = await fetch(u, opts);
                const ct = r.headers.get("content-type");
                const res = (ct && ct.includes("json")) ? await r.json() : await r.text();
                log(res);
            } catch (e) { log(e.message, true); }
        }

        const GET = (p) => req('GET', p);
        const POST = (e) => {
            e.preventDefault();
            req('POST', '/Consigne', {
                ConsigneDegre: parseInt($('c_deg').value),
                ConsigneDegreElec: parseInt($('c_elec').value),
                NumberGain: parseInt($('n_gain').value),
                ChoixGaine: $('c_gaine').value,
                ChoixForce: parseInt($('c_force').value),
                ipPC: $('ip_pc').value
            });
        };
        const ping = () => GET('/');
    </script>
</body>
</html>